---
import { SITE_CONFIG } from '../data/site-config';
import Footer from '../components/common/Footer.astro';
import Header from '../components/common/Header.astro';
import SEOHead from '../components/seo/SEOHead.astro';
import ThemeToggle from '../components/common/ThemeToggle.astro';
import LanguageSwitcher from '../components/common/LanguageSwitcher.astro';
import StructuredData from '../components/StructuredData.astro';
import SearchModal from '../components/search/SearchModal.astro';
import '../assets/styles/global.css';
import Logo from '../components/Logo.astro';

export interface Props {
  title?: string;
  description?: string;
  ogImage?: string;
  article?: {
    publishedTime?: Date;
    modifiedTime?: Date;
    author?: string;
    tags?: string[];
  };
  noindex?: boolean;
  breadcrumb?: Array<{
    name: string;
    url: string;
  }>;
  hideSearch?: boolean;
  hideThemeToggle?: boolean;
  siteName?: string;
  currentLanguage?: string;
  availableLanguages?: string[];
  currentSlug?: string;
  pageType?: 'blog-post' | 'blog-index' | 'blog-tag' | 'blog-category';
  pageIdentifier?: string;
}

const {
  title = SITE_CONFIG.title,
  description = SITE_CONFIG.description,
  ogImage = SITE_CONFIG.ogImage,
  article,
  noindex = false,
  breadcrumb,
  hideSearch = false,
  hideThemeToggle = false,
  siteName,
  currentLanguage,
  availableLanguages,
  currentSlug,
  pageType,
  pageIdentifier,
} = Astro.props;

// Check if we're on a policy page
const isPolicyPage = Astro.url.pathname.includes('terms-of-service') ||
                   Astro.url.pathname.includes('privacy-policy') ||
                   Astro.url.pathname.includes('refund-cancellation-policy') ||
                   Astro.url.pathname.includes('ai-content-usage-policy');

// Check if we're on a blog page (including translated pages like /es/blog, /fr/blog, etc.)
const isBlogPage = Astro.url.pathname.includes('/blog') || Astro.url.pathname.startsWith('/page/');
---

<!DOCTYPE html>
<html lang={SITE_CONFIG.locale} class="scroll-smooth">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/png" href="/favicon.png" />
    <meta name="generator" content={Astro.generator} />

    <!-- Google Fonts - non-render-blocking -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <!-- Load fonts async to prevent render blocking -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Inter:wght@400;500;600;700&display=swap" media="print" onload="this.media='all'" />
    <noscript>
      <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Inter:wght@400;500;600;700&display=swap" />
    </noscript>

    <SEOHead
      title={title}
      description={description}
      ogImage={ogImage}
      article={article}
      noindex={noindex}
      breadcrumb={breadcrumb}
      currentLanguage={currentLanguage}
      availableLanguages={availableLanguages}
      currentSlug={currentSlug}
      pageType={pageType}
      pageIdentifier={pageIdentifier}
    />
    
    <!-- Structured Data (Schema.org) -->
    <StructuredData
      type={article ? 'article' : 'website'}
      title={title}
      description={description}
      author={article?.author}
      datePublished={article?.publishedTime?.toISOString()}
      dateModified={article?.modifiedTime?.toISOString()}
      image={ogImage}
      url={Astro.url.toString()}
    />

    <!-- Dark mode script -->
    <script is:inline>
      const theme = (() => {
        if (typeof localStorage !== 'undefined' && localStorage.getItem('theme')) {
          return localStorage.getItem('theme');
        }
        if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
          return 'dark';
        }
        return 'light';
      })();
      
      if (theme === 'dark') {
        document.documentElement.classList.add('dark');
      }
    </script>
  </head>
  <body>
    <!-- Navigation Header -->
    <Header showSearch={true} />

    <!-- Language Switcher (only on blog pages) -->
    {isBlogPage && (
      <div class="fixed top-20 left-4 z-40">
        <LanguageSwitcher
          currentLanguage={currentLanguage}
          availableLanguages={availableLanguages}
          currentSlug={currentSlug}
        />
      </div>
    )}

    <div class="min-h-screen flex flex-col">
      <main class="flex-grow">
        <slot />
      </main>
      <Footer siteName={siteName} />
    </div>

    <!-- Search Modal -->
    <SearchModal />
  </body>
</html>